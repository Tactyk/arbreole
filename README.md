### Before starting

In this documentation, we will use the terminal to perform some command lines. Here, every command will be prefixed by **$**.

### Get the project!

In your favorite terminal (for Mac we advice you to get iTerm2, for linux the default terminal with [ohmyzsh](https://github.com/robbyrussell/oh-my-zsh))

```sh
$ cd ~  # tilde means home
$ mkdir arbreole && cd arbreole # mkdir: make directory, cd: change directory
$ git clone git@github.com:Tactyk/arbreole.git # retrieve code
$ ./setup.sh # Set up ip address and port
```

### Project architecture

You can see now the project structure in your 'arbreole' folder

```sh
$ ls # list the current folder
```

The `_doc` folder contains more informations about the technologies used in this project.

The `arduino` folder contains the code related to manipulating the leds and the sounds.

The `client` folder contains the webSocket client hosted on the Raspberry Pi.

The `config` folder contains configuration data, which can be edited by hand but is meant to be auto-generated by `setup.sh`.

The `interface` folder contains the code used in the web client.

The `scripts` folder contains scripts used to update the RaspberryPi.

The `server` folder contains the web server interacting with the RaspberryPi and web clients.

### Development tools

* Download and install [PyCharm Community Edition](https://www.jetbrains.com/pycharm/download/)

* Configuration:

  Preferences > Project > Project Interpreter >

  1. Click on the setting wheel and
  2. Choose a Python 3 interpreter ![Choose a Python 3 interpreter](./_doc/img/python_interpreter.png)

### RaspberryPi (rPi) initialization:

Follow [this link](https://www.imore.com/how-get-started-using-raspberry-pi) to format SD card and install Raspbian (Debian version for rPi)

### RaspberryPi (rPi) connection:

1. Make sure that your raspberryPi is connected to the same wifi as your computer sharing connection between both via ethernet cable.

Linux (Ubuntu): https://roughlea.wordpress.com/raspberry-pi-experiences/configure-the-raspberry-pi-to-share-a-linux-internet-connection/

Mac: https://medium.com/@tzhenghao/how-to-ssh-into-your-raspberry-pi-with-a-mac-and-ethernet-cable-636a197d055`

2. Find RaspberryPi IP:

* into the raspberryPi (need to cable a monitor with an HDMI), open a terminal and type
  $ `ifconfig`
* copy the raspberryPi (en0) IP. Replace the IP in the arbreole/scripts/raspberry_hostnames (remember me keep the "pi@")

* From your computer you can now connect to your raspberryPi via ssh.

$`ssh pi@{raspberry-ip}` {raspberry-ip} means it is a variable that you have to change with the raspberry IP (192.23.98.10 for example). It will ask you for a password, the default one is **raspberry**

### RaspberryPi (rPi) client installation:

In this project, we use **python3**. In order order to install python3 packages, use the pip3 packages installer. It should be already in rPi but nevertheless:

* SSH into your pi, then

  ```sh
  $ sudo apt-get update # Update packages
  $ sudo apt-get install python3-pip # Install pip3 and python3
  $ pip3 install websocket-client pyserial # Install packages
  ```

  To communicate with the server, we will use websockets, with the **websocket-client** library.

  Each module will be recognize by your IDE (PyCharm or other) because it knows the PYTHONPATH global environment var.
  If you needed to put modules in a special folder. You should add its path to PYTHONPATH var to avoid errors in your IDE: `$ export PYTHONPATH="${PYTHONPATH}:/my/other/path"`

* In **your machine** from **your project folder** (arbreole/):

  $`./scripts/install_raspberry_pi.sh` (it will ask you for password two times)

### Server installation:

In order to have a Python Webserver and an easy websocket usage, we're going to use the python Tornado framework.

**In your machine:**

* Prerequisites are same than for rPi session.

* Install tornado for your web server and tinydb to handle module states:

  ```
  $ pip3 install tornado tinydb
  ```

### Usage

Everything is now installed !

#### Run the local server

To run the local webserver, go to your project folder and type

```sh
python3 ./server/webserver.py
```

You should see something along the lines of `Server listening on ip: 192.168.1.20 at port 8080`.

In your browser, got o `http://{host-ip}:{host-port}/` to see the interface page.

A first client is now connected to the server via websocket.

NB: Open the developer console tool to see logs for debugging. (Right click > inspect > Console tab)

#### Run the rPi client server

SSH into the RaspberryPi and run

```sh
$ cd arbreole/src
$ python3 webSocketClient.py
```

you should see `Server connection opened` in your rPi terminal side and `New connection` at the server host side terminal.

Everything is now connected by websocket. Try to add a text in your web client, enter and see every logs in terminal/console.

#### Scripts

You can find some useful scripts into server/script/ folder. To run it, **from your project folder**, type `./server/scripts/{script-name}.sh`

* update_config.sh : update the config.ini file on the RaspberryPi

### Contributing

If you want to add your code to the project, submit a Pull Request. Please follow the instructions [here](./_doc/using_git.md#pull-requests)

##### TODO

* [ ] TroubleShootings â€¨- Import not recognize
* [ ] Open one folder at once with PyCharm
